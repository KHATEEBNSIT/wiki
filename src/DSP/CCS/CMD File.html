<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>CMD File</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="CMD File"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-08-18 23:55:51 HKT"/>
<meta name="author" content="Shi Shougang"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../../assets/stylesheet.css" />
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">CMD File</h1>

<ul>
<li>Linker CMD Files for CCS
  <a href="http://processors.wiki.ti.com/index.php/Linker_CMD_Files_for_CCS">http://processors.wiki.ti.com/index.php/Linker_CMD_Files_for_CCS</a>

</li>
<li>TMS320C6000 Assembly Language Tools
  Chapter5: Linking C/C++ Code

<p>
  pdf: <a href="./spru186v.pdf">TMS320C6000 Assembly Language Tools</a>
</p></li>
<li>TMS320C6000 Optimizing Compiler v 7.3
  Chapter7: Linker Description

<p>
  pdf: <a href="./spru187t.pdf">TMS320C6000 Optimizing Compiler v 7.3</a>
</p></li>
</ul>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Linker Overview</a></li>
<li><a href="#sec-2">Linker Options</a>
<ul>
<li><a href="#sec-2-1">Wild Cards in File, Section, and Symbol Patterns</a></li>
<li><a href="#sec-2-2">Define Heap Size (<code>--heap_size</code> Option)</a></li>
<li><a href="#sec-2-3">Define Stack Size (<code>--stack_size</code> Option)</a></li>
<li><a href="#sec-2-4">Constants in Linker Command Files</a></li>
<li><a href="#sec-2-5">The MEMORY Directive</a></li>
<li><a href="#sec-2-6">The SECTIONS Directive</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Linker Overview</h2>
<div class="outline-text-2" id="text-1">

<p>Two powerful directives, MEMORY and SECTIONS, allow you to:
</p>
<p>
• Allocate sections into specific areas of memory
• Combine object file sections
• Define or redefine global symbols at link time
</p></div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Linker Options</h2>
<div class="outline-text-2" id="text-2">

<ul>
<li><code>--heap_size</code> 
 <code>-heap</code> Sets heap size (for the dynamic memory allocation in C) to
 size bytes and defines a global symbol that specifies the
 heap size. Default = 1K bytes. Section 7.4.11<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup> 
</li>
<li><code>--stack_size</code>
 <code>-stack</code> Sets C system stack size to size bytes and defines
  a global symbol that specifies the stack size.
  Default = 1K bytes. Section 7.4.26<sup><a class="footref" name="fnr.1.2" href="#fn.1">1</a></sup>
</li>
</ul>


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">Wild Cards in File, Section, and Symbol Patterns</h3>
<div class="outline-text-3" id="text-2-1">

<p>The linker allows file, section, and symbol names to be specified using the asterisk (*) and question mark
(?) wild cards. Using * matches any number of characters and using ?
matches a single character.
</p><ul>
<li id="sec-2-1-1">Example<br/>



<pre class="src src-c">SECTIONS
{
.fast_code: { *.obj(*fast*) } &gt; FAST_MEM
.vectors : { vectors.obj(.vector:part1:*) &gt; 0xFFFFFF00
.str_code : { rts*.lib&lt;str*.obj&gt;(.text) } &gt; S1ROM
}
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2">Define Heap Size (<code>--heap_size</code> Option)</h3>
<div class="outline-text-3" id="text-2-2">

<p>The C/C++ compiler uses an uninitialized section called <code>.sysmem</code> for
the C run-time memory pool used by <code>malloc()</code>. You can set the size of
this memory pool at link time by using the &ndash;heap<sub>size</sub> option. The
syntax for the &ndash;heap<sub>size</sub> option is:
</p>
<p>
<code>--heap_size= size</code>
</p>
<p>
The size must be a constant. This example defines a 4K byte heap:
</p>


<pre class="src src-c">cl6x --run_linker --heap_size=0x1000 <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">defines a 4k heap (.sysmem section)</span><span style="color: #ff7f24;">*/</span>
</pre>

<p>
The linker creates the <code>.sysmem</code> section only if there is a .sysmem section in an input file.
The linker also creates a global symbol _<sub>SYSMEM</sub><sub>SIZE</sub> and assigns it a
value equal to the size of the heap. The <b>default</b> size is 1K bytes.
</p>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3">Define Stack Size (<code>--stack_size</code> Option)</h3>
<div class="outline-text-3" id="text-2-3">

<p>The TMS320C6000 C/C++ compiler uses an uninitialized section,
<code>.stack</code>, to allocate space for the run-time stack. The syntax for the
<code>--stack_size</code> option is:
</p>
<p>
<code>--stack_size= size</code>
The size must be a constant and is in bytes. This example defines a 4K byte stack:
</p>


<pre class="src src-c">cl6x --run_linker --stack_size=0x1000 <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">defines a 4K heap (.stack section)</span><span style="color: #ff7f24;">*/</span>
</pre>


<p>
When the linker defines the .stack section, it also defines a global
symbol, <code>__STACK_SIZE</code>, and assigns it a value equal to the size of the
section. The <b>default</b> software stack size is 1K bytes.
</p>
</div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4">Constants in Linker Command Files</h3>
<div class="outline-text-3" id="text-2-4">

<ul>
<li id="sec-2-4-1">Examples<br/>



<pre class="src src-c">Format            Decimal    Octal    Hexadecimal
<span style="color: #98fb98;">Assembler</span> <span style="color: #eedd82;">format</span>  32         40q      020h
C format          32         040      0x20
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5">The MEMORY Directive</h3>
<div class="outline-text-3" id="text-2-5">

<p>The linker determines where output sections are allocated into memory; it must have a model of target
memory to accomplish this. The MEMORY directive allows you to specify a model of target memory so
that you can define the types of memory your system contains and the
address ranges they occupy.
</p>
<p>
After you use MEMORY to define a
memory model, you can use the SECTIONS directive to allocate output
sections into defined memory.
</p><ul>
<li id="sec-2-5-1">MEMORY Directive Syntax<br/>
The MEMORY directive in Example defines a
system that has 4K bytes of fast external memory at address 0x0000 0000, 2K bytes of slow external
memory at address 0x0000 1000 and 4K bytes of slow external memory at address 0x1000 0000. It also
demonstrates the use of memory range expressions as well as
start/end/size address operators

<p>
 <b>Example</b>
</p>


<pre class="src src-c"><span style="color: #ff7f24;">/********************************************************/</span>
<span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Sample command file with MEMORY directive </span><span style="color: #ff7f24;">*/</span>
<span style="color: #ff7f24;">/********************************************************/</span>
file1.obj file2.obj <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Input files </span><span style="color: #ff7f24;">*/</span>
--output_file=prog.out <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Options </span><span style="color: #ff7f24;">*/</span>
<span style="color: #b0c4de;">#define</span> <span style="color: #eedd82;">BUFFER</span> 0
MEMORY
{
FAST_MEM (RX): origin = 0x00000000 length = 0x00001000 + BUFFER
SLOW_MEM (RW): origin = end(FAST_MEM) length = 0x00001800 - size(FAST_MEM)
EXT_MEM (RX): origin = 0x10000000 length = size(FAST_MEM)
}
</pre>


<p>
The general syntax for the MEMORY directive is:
</p>


<pre class="src src-c">MEMORY
{
name 1 [( attr )] : origin = expression , length = expression [, fill = constant]
.
.
name n [( attr )] : origin = expression , length = expression [, fill = constant]
}
</pre>


<ul>
<li>attr 
  <b>R</b> specifies that the memory can be read.
  <b>W</b> specifies that the memory can be written to.
  <b>X</b> specifies that the memory can contain executable code.
  <b>I</b> specifies that the memory can be initialized.
</li>
<li>origin
  specifies the starting address of a memory range; enter as origin,
  org, or o. The value, specified in bytes, is an expression of 32-bit
  constants, which can be decimal, octal, or hexadecimal.
</li>
<li>length
  specifies the length of a memory range; enter as length, len, or l.
  The value, specified in bytes, is an expression of 32-bit constants,
</li>
<li>fill
  specifies a fill character for the memory range; enter as fill or f.
  Fills are optional. The value is a integer constant and can be
  decimal, octal, or hexadecimal. The fill value is used to fill areas
  of the memory range that are not allocated to a section
</li>
</ul>


<p class="info">Filling Memory Ranges: If you specify fill values for large memory ranges, your output file will be very large because
filling a memory range (even with 0s) causes raw data to be generated for all unallocated
blocks of memory in the range.  </p>
<p>
 <b>Example</b>
The following example specifies a memory range with the R and W
attributes and a fill constant of 0FFFFFFFFh
</p>


<pre class="src src-c">MEMORY
{
RFILE (RW) : o = 0x00000020, l = 0x00001000, f = 0xFFFFFFFF
}
</pre>

</li>
</ul>
<ul>
<li id="sec-2-5-2">Expressions and Address Operators<br/>
Three new address operators have been added for referencing memory range properties from prior
memory range entries:

<ul>
<li>START(MR) Returns start address for previously defined memory range MR.
</li>
<li>SIZE(MR) Returns size of previously defined memory range MR.
</li>
<li>END(MR) Returns end address for previously defined memory range MR.
 <b>Example</b>
</li>
</ul>




<pre class="src src-c"><span style="color: #ff7f24;">/********************************************************/</span>
<span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Sample command file with MEMORY directive </span><span style="color: #ff7f24;">*/</span>
<span style="color: #ff7f24;">/********************************************************/</span>
file1.obj file2.obj <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Input files </span><span style="color: #ff7f24;">*/</span>
--output_file=prog.out <span style="color: #ff7f24;">/* </span><span style="color: #ff7f24;">Options </span><span style="color: #ff7f24;">*/</span>
<span style="color: #b0c4de;">#define</span> <span style="color: #eedd82;">ORIGIN</span> 0x00000000
<span style="color: #b0c4de;">#define</span> <span style="color: #eedd82;">BUFFER</span> 0x00000200
<span style="color: #b0c4de;">#define</span> <span style="color: #eedd82;">CACHE</span> 0x0001000
MEMORY
{
FAST_MEM (RX): origin = ORIGIN + CACHE length = 0x00001000 + BUFFER
SLOW_MEM (RW): origin = end(FAST_MEM) length = 0x00001800 - size(FAST_MEM)
EXT_MEM (RX): origin = 0x10000000 length = size(FAST_MEM) - CACHE
}
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-2-6" class="outline-3">
<h3 id="sec-2-6">The SECTIONS Directive</h3>
<div class="outline-text-3" id="text-2-6">

<ul>
<li id="sec-2-6-1">SECTIONS Directive Syntax<br/>



<pre class="src src-c">SECTIONS
{
<span style="color: #7fffd4;">name</span> : [property [, property] [, property] . . . ]
name : [property [, property] [, property] . . . ]
name : [property [, property] [, property] . . . ]
}
</pre>

<p>
Possible properties for a section are as follows:
• Load allocation defines where in memory the section is to be loaded.
</p>
<p>
Syntax: load = allocation  or allocation  or &gt; allocation
</p>
<p>
• Run allocation defines where in memory the section is to be run.
Syntax: run = allocation or
run &gt; allocation
• Input sections defines the input sections (object files) that constitute the output section.
Syntax: { input<sub>sections</sub> }
• Section type defines flags for special section types. See Section 7.5.7
Syntax: type = COPY or
type = DSECT or
type = NOLOAD
• Fill value defines the value used to fill uninitialized holes. See Section 7.5.9.
Syntax: fill = value or
name : [properties = value]
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> TMS320C6000 Assembly Language Tools
</p>


</li>
</ul>
</div>
</div>
</div>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-08-18 23:55:51 HKT</p>
<p class="author">Author: Shi Shougang</p>
<p class="creator">Org version 7.8.09 with Emacs version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
