<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Shell Scrap</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Shell Scrap"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-11-29T00:47+0800"/>
<meta name="author" content="Shi Shougang"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="./assets/stylesheet.css" type="text/css"/>
<link rel="stylesheet" type="text/css" href="../assets/stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Shell Scrap</h1>



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Flow Control</a>
<ul>
<li><a href="#sec-1-1">if</a></li>
<li><a href="#sec-1-2">case</a></li>
<li><a href="#sec-1-3">Loops</a></li>
</ul>
</li>
<li><a href="#sec-2">Keyboard Input</a>
<ul>
<li><a href="#sec-2-1">read</a></li>
</ul>
</li>
<li><a href="#sec-3">Parameters</a>
<ul>
<li><a href="#sec-3-1"><code>$#</code></a></li>
<li><a href="#sec-3-2"><code>shift</code></a></li>
</ul>
</li>
<li><a href="#sec-4">Errors and Signals and Traps</a>
<ul>
<li><a href="#sec-4-1">Exit status</a></li>
</ul>
</li>
<li><a href="#sec-5">Creating safe temporary files</a>
<ul>
<li><a href="#sec-5-1">example</a></li>
</ul>
</li>
<li><a href="#sec-6">Debug</a>
<ul>
<li><a href="#sec-6-1">Watching your script run</a></li>
</ul>
</li>
<li><a href="#sec-7">Command</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Flow Control</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">if</h3>
<div class="outline-text-3" id="text-1-1">

<ul>
<li id="sec-1-1-1">syntax<br/>



<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">First form</span>

<span style="color: #00ffff;">if</span> condition ; <span style="color: #00ffff;">then</span>
    commands
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Second form</span>

<span style="color: #00ffff;">if</span> condition ; <span style="color: #00ffff;">then</span>
    commands
<span style="color: #00ffff;">else</span>
    commands
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Third form</span>

<span style="color: #00ffff;">if</span> condition ; <span style="color: #00ffff;">then</span>
    commands
<span style="color: #00ffff;">elif</span> condition ; <span style="color: #00ffff;">then</span>
    commands
<span style="color: #00ffff;">fi</span>
</pre>


</li>
</ul>
<ul>
<li id="sec-1-1-2">Example<br/>



<pre class="src src-sh"><span style="color: #00ffff;">if</span> [ -f .bash_profile ]; <span style="color: #00ffff;">then</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You have a .bash_profile. Things are fine."</span>
<span style="color: #00ffff;">else</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Yikes! You have no .bash_profile!"</span>
<span style="color: #00ffff;">fi</span>
</pre>


</li>
</ul>
<ul>
<li id="sec-1-1-3">Condition<br/>
Expression    Description

<ul>
<li>-d file True if file is a directory.
</li>
<li>-e file True if file exists.
</li>
<li>-f file True if file exists and is a regular file.
</li>
<li>-L file True if file is a symbolic link.
</li>
<li>-r file True if file is a file readable by you.
</li>
<li>-w file True if file is a file writable by you.
</li>
<li>-x file True if file is a file executable by you.
</li>
<li>file1 -nt file2  True if file1 is newer than (according to modification time) file2
</li>
<li>file1 -ot file2  True if file1 is older than file2
</li>
<li>-z string True if string is empty.
</li>
<li>-n string  True if string is not empty.
</li>
<li>string1 = string2  True if string1 equals string2.
</li>
<li>string1 != string2  True if string1 does not equal string2.
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">case</h3>
<div class="outline-text-3" id="text-1-2">

<ul>
<li id="sec-1-2-1">syntax<br/>



<pre class="src src-sh"><span style="color: #00ffff;">case</span> word<span style="color: #00ffff;"> in</span>
    patterns ) statements ;;
<span style="color: #00ffff;">esac</span>
</pre>


</li>
</ul>
<ul>
<li id="sec-1-2-2">example<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Enter a number between 1 and 3 inclusive &gt; "</span>
<span style="color: #b0c4de;">read</span> character
<span style="color: #00ffff;">case</span> $<span style="color: #eedd82;">character</span><span style="color: #00ffff;"> in</span>
    1 ) <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You entered one."</span>
        ;;
    2 ) <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You entered two."</span>
        ;;
    3 ) <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You entered three."</span>
        ;;
    * ) <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You did not enter a number"</span>
        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"between 1 and 3."</span>
<span style="color: #00ffff;">esac</span>
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3">Loops</h3>
<div class="outline-text-3" id="text-1-3">

<ul>
<li id="sec-1-3-1">while<br/>
<ul>
<li id="sec-1-3-1-1">example<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #eedd82;">number</span>=0
<span style="color: #00ffff;">while</span> [ $<span style="color: #eedd82;">number</span> -lt 10 ]; <span style="color: #00ffff;">do</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Number = $number"</span>
    <span style="color: #eedd82;">number</span>=$((number + 1))
<span style="color: #00ffff;">done</span>
</pre>

</li>
</ul>
</li>
</ul>
<ul>
<li id="sec-1-3-2">until<br/>
The until command works exactly the same way, except the block of code
is repeated as long as the condition is false.

<ul>
<li id="sec-1-3-2-1">Example<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #eedd82;">number</span>=0
<span style="color: #00ffff;">until</span> [ $<span style="color: #eedd82;">number</span> -ge 10 ]; <span style="color: #00ffff;">do</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Number = $number"</span>
    <span style="color: #eedd82;">number</span>=$((number + 1))
<span style="color: #00ffff;">done</span>
</pre>


</li>
</ul>
</li>
</ul>
<ul>
<li id="sec-1-3-3"><code>for</code><br/>
<ul>
<li id="sec-1-3-3-1">syntax<br/>



<pre class="src src-sh"><span style="color: #00ffff;">for</span> variable<span style="color: #00ffff;"> in</span> words; <span style="color: #00ffff;">do</span>
    statements
<span style="color: #00ffff;">done</span>
</pre>

</li>
</ul>
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Keyboard Input</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">read</h3>
<div class="outline-text-3" id="text-2-1">

<ul>
<li id="sec-2-1-1">example<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span><span style="color: #ff7f24;"> </span>

<span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Enter some text &gt; "</span>
<span style="color: #b0c4de;">read</span> text
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"You entered: $text"</span>
</pre>

</li>
</ul>
<ul>
<li id="sec-2-1-2">option <code>-t</code> (time)<br/>
The -t option followed by a number of seconds provides an automatic
timeout for the read command. 



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>
<span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Hurry up and type something! &gt; "</span>
<span style="color: #00ffff;">if </span><span style="color: #b0c4de;">read</span> -t 3 response; <span style="color: #00ffff;">then</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Great, you made it in time!"</span>
<span style="color: #00ffff;">else</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Sorry, you are too slow!"</span>
<span style="color: #00ffff;">fi</span>
</pre>


</li>
</ul>
<ul>
<li id="sec-2-1-3">option <code>-s</code><br/>
The -s option causes the user's typing not to be displayed. 

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Parameters</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><code>$#</code></h3>
<div class="outline-text-3" id="text-3-1">

<p>the shell maintains a variable called $# that contains the number of
items on the command line
</p></div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><code>shift</code></h3>
<div class="outline-text-3" id="text-3-2">

<p><code>shift</code> is a shell builtin that operates on the positional parameters.
Each time you invoke shift, it "shifts" all the positional parameters
down by one. $2 becomes $1, $3 becomes $2, $4 becomes $3, and so on.
</p>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Errors and Signals and Traps</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1">Exit status</h3>
<div class="outline-text-3" id="text-4-1">

<ul>
<li id="sec-4-1-1">Checking the exit status<br/>
First, you can examine the contents of the $? environment variable. $?
will contain the exit status of the last command executed.




<pre class="src src-sh">[me] $ true; <span style="color: #b0c4de;">echo</span> $<span style="color: #eedd82;">?</span>
0
[me] $ false; <span style="color: #b0c4de;">echo</span> $<span style="color: #eedd82;">?</span>
1
</pre>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Creating safe temporary files</h2>
<div class="outline-text-2" id="text-5">

<p>The preferred technique is to write them in a local directory such as
<code>~/tmp</code> (a tmp subdirectory in the user's home directory.) If you must
write files in <code>/tmp</code>, you must take steps to make sure the file names
are not predictable. Predictable file names allow an attacker to
create symbolic links to other files that the attacker wants you to
overwrite.
</p>
</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1">example</h3>
<div class="outline-text-3" id="text-5-1">




<pre class="src src-sh"><span style="color: #eedd82;">TEMP_FILE</span>=$<span style="color: #eedd82;">TEMP_DIR</span>/printfile.$<span style="color: #eedd82;">$</span>.$<span style="color: #eedd82;">RANDOM</span>
</pre>

<ul>
<li><code>$$</code> shell variable to embed the process id (pid) of the program
</li>
<li><code>$RANDOM</code> shell variable to append a random number to the file name
</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">Debug</h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1">Watching your script run</h3>
<div class="outline-text-3" id="text-6-1">

<ul>
<li id="sec-6-1-1">Method1<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span><span style="color: #ff7f24;"> -x</span>
</pre>

</li>
</ul>
<ul>
<li id="sec-6-1-2">Method2<br/>
you can use the set command within your script to turn tracing on and
off. Use <code>set -x</code> to turn tracing on and <code>set +x</code> to turn tracing off. For
example.:




<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>

<span style="color: #eedd82;">number</span>=1

<span style="color: #b0c4de;">set</span> -x
<span style="color: #00ffff;">if</span> [ $<span style="color: #eedd82;">number</span> = <span style="color: #ffa07a;">"1"</span> ]; <span style="color: #00ffff;">then</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Number equals 1"</span>
<span style="color: #00ffff;">else</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Number does not equal 1"</span>
<span style="color: #00ffff;">fi</span>
<span style="color: #b0c4de;">set</span> +x
</pre>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">Command</h2>
<div class="outline-text-2" id="text-7">

<p>!$
!$是一个特殊的环境变量，它代表了上一个命令的最后一个字符串。如：你可能会这样：
$mkdir mydir
$mv mydir yourdir
$cd yourdir
可以改成：
$mkdir mydir
$mv !$ yourdir
$cd !$
sudo !!
以root的身份执行上一条命令 。
场景举例：比如Ubuntu里用apt-get安装软件包的时候是需要root身份的，我们经常会忘记在apt-get前加sudo。每次不得不加上sudo再重新键入这行命令，这时可以很方便的用sudo !!完事。
（陈皓注：在shell下，有时候你会输入很长的命令，你可以使用!xxx来重复最近的一次命令，比如，你以前输入过，vi /where/the/file/is, 下次你可以使用 !vi 重得上次最近一次的vi命令。）
cd –
回到上一次的目录 。
场景举例：当前目录为/home/a，用cd ../b切换到/home/b。这时可以通过反复执行cd –命令在/home/a和/home/b之间来回方便的切换。
（陈皓注：cd ~ 是回到自己的Home目录，cd ~user，是进入某个用户的Home目录）
‘ALT+.’ or ‘&lt;ESC&gt; .’
热建alt+. 或 esc+. 可以把上次命令行的参数给重复出来。
<sup>old</sup><sup>new</sup>
替换前一条命令里的部分字符串。
场景：echo "wanderful"，其实是想输出echo "wonderful"。只需要<sup>a</sup><sup>o就行了，对很长的命令的错误拼写有很大的帮助。（陈皓注：也可以使用</sup> !!:gs/old/new）
du -s * | sort -n | tail
列出当前目录里最大的10个文件。
:w !sudo tee %
在vi中保存一个只有root可以写的文件
date -d@1234567890
时间截转时间
&gt; file.txt
创建一个空文件，比touch短。
mtr coolshell.cn
mtr命令比traceroute要好。
在命令行前加空格，该命令不会进入history里。
echo “ls -l” | at midnight
在某个时间运行某个命令。
curl -u user:pass -d status=”Tweeting from the shell” <a href="http://twitter.com/statuses/update.xml">http://twitter.com/statuses/update.xml</a>
命令行的方式更新twitter。
curl -u username –silent “<a href="https://mail.google.com/mail/feed/atom">https://mail.google.com/mail/feed/atom</a>” | perl -ne ‘print “\t” if <i>&lt;name&gt;</i>; print “$2\n” if <i>&lt;(title|name)&gt;(.*)&lt;\</i>\1&gt;/;’
检查你的gmail未读邮件
ps aux | sort -nk +4 | tail
列出头十个最耗内存的进程
man ascii
显示ascii码表。
场景：忘记ascii码表的时候还需要google么?尤其在天朝网络如此“顺畅”的情况下，就更麻烦在GWF多应用一次规则了，直接用本地的man ascii吧。
ctrl-x e
快速启动你的默认编辑器（由变量$EDITOR设置）。
netstat –tlnp
列出本机进程监听的端口号。（陈皓注：netstat -anop 可以显示侦听在这个端口号的进程）
tail -f <i>path/to/file.log | sed '/<sup>Finished</sup>: SUCCESS$</i> q'
当file.log里出现Finished: SUCCESS时候就退出tail，这个命令用于实时监控并过滤log是否出现了某条记录。
ssh user@server bash &lt; /path/to/local/script.sh
在远程机器上运行一段脚本。这条命令最大的好处就是不用把脚本拷到远程机器上。
ssh user@host cat /path/to/remotefile | diff /path/to/localfile -
比较一个远程文件和一个本地文件
net rpc shutdown -I ipAddressOfWindowsPC -U username%password
远程关闭一台Windows的机器
screen -d -m -S some<sub>name</sub> ping my<sub>router</sub>
后台运行一段不终止的程序，并可以随时查看它的状态。-d -m参数启动“分离”模式，-S指定了一个session的标识。可以通过-R命令来重新“挂载”一个标识的session。更多细节请参考screen用法 man screen。
wget &ndash;random-wait -r -p -e robots=off -U mozilla <a href="http://www.example.com">http://www.example.com</a>
下载整个www.example.com网站。（注：别太过分，大部分网站都有防爬功能了：））
curl ifconfig.me
当你的机器在内网的时候，可以通过这个命令查看外网的IP。
convert input.png -gravity NorthWest -background transparent -extent 720×200  output.png
改一下图片的大小尺寸
lsof –i
实时查看本机网络服务的活动状态。
vim scp://username@host//path/to/somefile
vim一个远程文件
python -m SimpleHTTPServer
一句话实现一个HTTP服务，把当前目录设为HTTP服务目录，可以通过<a href="http://localhost:8000访问">http://localhost:8000访问</a> 这也许是这个星球上最简单的HTTP服务器的实现了。
history | awk '{CMD[$2]++;count++;} END { for (a in CMD )print CMD[a] " " CMD[a]/count*100 "% " a }' | grep -v "./" | column -c3 -s " " -t | sort -nr | nl | head -n10
(陈皓注：有点复杂了，history|awk ‘{print $2}’|awk ‘BEGIN {FS=”|”} {print $1}’|sort|uniq -c|sort -rn|head -10)
这行脚本能输出你最常用的十条命令，由此甚至可以洞察你是一个什么类型的程序员。
</p></div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-11-29T00:47+0800</p>
<p class="author">Author: Shi Shougang</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.2+ with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
