<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Bitbake &amp; OpenEmbedded Overview</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="Bitbake &amp; OpenEmbedded Overview"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-11-29T00:47+0800"/>
<meta name="author" content="Shi Shougang"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="./assets/stylesheet.css" type="text/css"/>
<link rel="stylesheet" type="text/css" href="../assets/stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Bitbake &amp; OpenEmbedded Overview</h1>



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">General</a>
<ul>
<li><a href="#sec-1-1">OpenEmbedded site</a></li>
<li><a href="#sec-1-2">bitbake</a></li>
</ul>
</li>
<li><a href="#sec-2">Install and Tutorial</a>
<ul>
<li><a href="#sec-2-1">Using OpenEmbedded on Linux systems</a></li>
<li><a href="#sec-2-2">Bitbake Tutorial</a></li>
<li><a href="#sec-2-3">Image Types and Bitbake Targets</a></li>
<li><a href="#sec-2-4">OpenEmbedded Directory Layout</a></li>
</ul>
</li>
<li><a href="#sec-3">Misc</a>
<ul>
<li><a href="#sec-3-1">Variable</a></li>
</ul>
</li>
<li><a href="#sec-4">Notes of OpenEmbedded User Manual</a>
<ul>
<li><a href="#sec-4-1"></a></li>
</ul>
</li>
<li><a href="#sec-5">Notes</a>
<ul>
<li><a href="#sec-5-1"><code>conf/documentation.conf</code></a></li>
<li><a href="#sec-5-2">OpenEmbedded HowTo</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">General</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">OpenEmbedded site</h3>
<div class="outline-text-3" id="text-1-1">

<p><a href="http://wiki.openembedded.org/index.php/Main_Page">http://wiki.openembedded.org/index.php/Main_Page</a>
</p></div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">bitbake</h3>
<div class="outline-text-3" id="text-1-2">

<p><a href="http://developer.berlios.de/projects/bitbake/">http://developer.berlios.de/projects/bitbake/</a>
</p>
<p>
obtained from git://git.openembedded.org/bitbake.git. Releases can be
downloaded from <a href="http://downloads.yoctoproject.org/releases/bitbake/">http://downloads.yoctoproject.org/releases/bitbake/</a>
and the developer mailing list, bitbake-devel can be found at
<a href="http://lists.linuxtogo.org/cgi-bin/mailman/listinfo/bitbake-devel">http://lists.linuxtogo.org/cgi-bin/mailman/listinfo/bitbake-devel</a>.
</p>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">Install and Tutorial</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1">Using OpenEmbedded on Linux systems</h3>
<div class="outline-text-3" id="text-2-1">

<p><a href="http://wiki.openembedded.org/index.php/OEandYourDistro">http://wiki.openembedded.org/index.php/OEandYourDistro</a>
</p></div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2">Bitbake Tutorial</h3>
<div class="outline-text-3" id="text-2-2">

<p><a href="http://gumstix.org/software-development/open-embedded/160-bitbake-tutorial.html">http://gumstix.org/software-development/open-embedded/160-bitbake-tutorial.html</a>
</p></div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3">Image Types and Bitbake Targets</h3>
<div class="outline-text-3" id="text-2-3">

<p><a href="http://gumstix.org/software-development/open-embedded/189-image-types-and-bitbake-targets.html">http://gumstix.org/software-development/open-embedded/189-image-types-and-bitbake-targets.html</a>
</p></div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4">OpenEmbedded Directory Layout</h3>
<div class="outline-text-3" id="text-2-4">

<p><a href="http://gumstix.org/software-development/open-embedded/161-openembedded-directory-layout.html">http://gumstix.org/software-development/open-embedded/161-openembedded-directory-layout.html</a>
</p>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">Misc</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">Variable</h3>
<div class="outline-text-3" id="text-3-1">

<p><code>openembedded/conf/bitbake.conf</code>
</p>


<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Path prefixes</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">base_prefix</span> = <span style="color: #ffa07a;">""</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">prefix</span> = <span style="color: #ffa07a;">"/usr"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">exec_prefix</span> = <span style="color: #ffa07a;">"/usr"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Base paths</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">base_bindir</span> = <span style="color: #ffa07a;">"${base_prefix}/bin"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">base_sbindir</span> = <span style="color: #ffa07a;">"${base_prefix}/sbin"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">base_libdir</span> = <span style="color: #ffa07a;">"${base_prefix}/lib"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Architecture independent paths</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">datadir</span> = <span style="color: #ffa07a;">"${prefix}/share"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">sysconfdir</span> = <span style="color: #ffa07a;">"${base_prefix}/etc"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">servicedir</span> = <span style="color: #ffa07a;">"${base_prefix}/srv"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">sharedstatedir</span> = <span style="color: #ffa07a;">"${base_prefix}/com"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">localstatedir</span> = <span style="color: #ffa07a;">"${base_prefix}/var"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">infodir</span> = <span style="color: #ffa07a;">"${datadir}/info"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">mandir</span> = <span style="color: #ffa07a;">"${datadir}/man"</span>
<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">docdir</span> = <span style="color: #ffa07a;">"${datadir}/doc"</span>
.....
<span style="color: #ff7f24;">##################################################################</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Download locations and utilities.</span>
<span style="color: #ff7f24;">##################################################################</span>

OE_STRICT_CHECKSUMS ?= <span style="color: #ffa07a;">"1"</span>

<span style="color: #eedd82;">ADOBE_MIRROR</span> = <span style="color: #ffa07a;">"http://fpdownload.macromedia.com/get/flashplayer/current/"</span>
<span style="color: #eedd82;">APACHE_MIRROR</span> = <span style="color: #ffa07a;">"http://archive.apache.org/dist"</span>
<span style="color: #eedd82;">DEBIAN_MIRROR</span> = <span style="color: #ffa07a;">"ftp://ftp.debian.org/debian/pool"</span>
<span style="color: #eedd82;">E_MIRROR</span> = <span style="color: #ffa07a;">"http://download.enlightenment.org/releases"</span>
<span style="color: #eedd82;">E_SVN</span> = <span style="color: #ffa07a;">"svn://svn.enlightenment.org/svn/e"</span>
<span style="color: #eedd82;">FREEBSD_MIRROR</span> = <span style="color: #ffa07a;">"ftp://ftp.freebsd.org/pub/FreeBSD/"</span>
<span style="color: #eedd82;">FREEDESKTOP_CVS</span> = <span style="color: #ffa07a;">"cvs://anoncvs:anoncvs@anoncvs.freedesktop.org/cvs"</span>
<span style="color: #eedd82;">FREESMARTPHONE_GIT</span> = <span style="color: #ffa07a;">"git://git.freesmartphone.org"</span>
<span style="color: #eedd82;">GENTOO_MIRROR</span> = <span style="color: #ffa07a;">"http://distfiles.gentoo.org/distfiles"</span>
<span style="color: #eedd82;">GNOME_GIT</span> = <span style="color: #ffa07a;">"git://git.gnome.org"</span>
...
</pre>


</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">Notes of OpenEmbedded User Manual</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"></h3>
<div class="outline-text-3" id="text-4-1">

</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">Notes</h2>
<div class="outline-text-2" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><code>conf/documentation.conf</code></h3>
<div class="outline-text-3" id="text-5-1">


<p class="verse">
PN[doc] = "PN holds the name of the package (Package Name). It is gathered from the bitbake-file filename"<br/>
PV[doc] = "PV holds the version of the package (Package Version). The default value is 1.0, it is \<br/>
retrieved from the bitbake-file filename but can be changed."<br/>
PR[doc] = "PR is the revision of the package (Package Revision). By default it is set to r0."<br/>
PF[doc] = "Package name - Package version - Package revision (PN-PV-PR)"<br/>
P[doc]  = "Package name - Package version (PN-PF)"<br/>
S[doc] = "Directory that holds the sources to build, WORKDIR/PN-PV by default. The 'make' or equivalent command is run from this directory."<br/>
SECTION[doc]  = "Section of the packages e.g. console/networking"<br/>
<br/>
GROUP<sub>dependencies[doc]</sub> = "The keys in this group influence the dependency handling of BitBake \<br/>
and the resulting packages."<br/>
DEPENDS[doc]  = "Build time dependencies, things needed to build the package. @group dependencies"<br/>
RDEPENDS[doc] = "Run time dependencies, things needed for a given package to run.  This is used to populate the ipkg:Depends field. @group dependencies"<br/>
PROVIDES[doc] = "Names for additional build time dependencies that this package will provide. @group dependencies"<br/>
RPROVIDES[doc] = "Names for additional run time dependencies that this<br/>
package will provide.  This is used to populate the ipkg:Provides field. @group dependencies"<br/>
<br/>
DL<sub>DIR[doc]</sub> = "The directory where tarballs will be stored. @group fetcher"<br/>
<br/>
</p>


</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2">OpenEmbedded HowTo</h3>
<div class="outline-text-3" id="text-5-2">

<p>From: <a href="http://www.uv-ac.de/openembedded/openembedded.html#toc3">http://www.uv-ac.de/openembedded/openembedded.html#toc3</a>
</p><ul>
<li id="sec-5-2-1">Bitbake<br/>
<ul>
<li id="sec-5-2-1-1">Examples<br/>

<p>
A bitbake nano will parse all *.bb files defined in local.conf, build a hash and build everything, which nano depends on and last but not least nano itself.
</p>
<p>
A bitbake -c clean nano will clean the nano package.
</p>
<p>
A bitbake -b whereYourOEPackageDirIsbitbake/nano/nano<sub>1</sub>.3.5.bb / will just build nano. All depends have already to be fullfilled for that. This does not execute the bb file parsing and spares time (e.g. during debugging).
</p>
<p>
A bitbake -b whereYourOEPackageDirIsbitbake/nano/nano<sub>1</sub>.3.5.bb -f -c clean / will force a clean on the already builded nano package.
</p>
<p>
A bitbake -b whereYourOEPackageDirIsbitbake/nano/nano<sub>1</sub>.3.5.bb -f -c fetch / will force a fetch on the already builded nano package. The package source is downloaded again independent of the cache status.
</p>
<p>
A bitbake -b whereYourOEPackageDirIsbitbake/nano/nano<sub>1</sub>.3.5.bb -f -c build / will force a build on the nano package. This will execute all stages "before" compile like fetch, patch, configure &hellip; and compile itself.
</p>
<p>
A bitbake -D -D -D nano will build the nano package and show you all files parsed.
</p>
<p>
A bitbake virtual/kernel -c clean; bitbake virtual/kernel builds a new
kernel for the opie-image and afterwards the related image.
</p></li>
</ul>
</li>
</ul>
<ul>
<li id="sec-5-2-2">How the configuration works<br/>
An example is described in the following list.

<ul>
<li>openembedded/conf/bitbake.conf
  This is where all parsing starts.
</li>
<li>YourBuildDir/conf/local.conf
  Here you can do you local configuration. Most interesting options are MACHINE and DISTRO. A TARGET<sub>OS</sub> or TARGET<sub>ARCH</sub> are normally defined somewhere deeper in the conf tree.
</li>
<li>openembedded/conf/machine/YourDefinedMachine.conf
  And all included machine<sub>xxx</sub>.conf files. Here the HW-dependend options (kernel, etc &hellip;) are defined.
</li>
<li>openembedded/conf/distro/YourDefinedDistro.conf
  And all included YourDefinedDistro<sub>xxx</sub>.conf files (mostly none). Here the Distro dependend options are defined.
</li>
<li>All BBFILES defined .bb files
  This is the final run.
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-5-2-3">Cleaning<br/>
For example a qte rebuild needs



<pre class="src src-sh"><span style="color: #b0c4de;">cd</span> tmp/work
rm -rf *opie*
rm -rf libopie*
rm -rf libq*
rm -rf *qte*
<span style="color: #b0c4de;">cd</span> tmp/cache
rm -rf *opie*
rm -rf *libopie*
rm -rf *libq*
rm -rf *qte*
<span style="color: #b0c4de;">cd</span> tmp/stamps
rm -rf *opie*
rm -rf libopie*
rm -rf libq*
rm -rf *qte*
</pre>

<p>
before rebuilding.
</p>



</li>
</ul>
<ul>
<li id="sec-5-2-4">Debugging<br/>
<ul>
<li>Debugging output (-D)
  One option to get more information on the build process is to use
  additionally the -D option. This option may occur multiple times and
  thus increases the DebugLevel.
</li>
</ul>




<pre class="src src-sh">bitbake -D -D -D nano
</pre>

<ul>
<li>Show environment -e
  The option -e shows the environment variables set during a bitbake
  run.
</li>
</ul>




<pre class="src src-sh">bitbake -e nano 
</pre>

<ul>
<li>Show package versions -s
</li>
<li>Dry run -n
  The dry run can be used to check, whether all dependencies are
  fullfilled. Also versioning, etc. can be checked.
</li>
</ul>





</li>
</ul>
<ul>
<li id="sec-5-2-5">Using the tmp/deploy/ipk dir as your local repository<br/>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">sh</span>

<span style="color: #eedd82;">TFILE</span>=<span style="color: #ffa07a;">"doit.rc"</span>
rm -f ${<span style="color: #eedd82;">TFILE</span>}
rm -f Packages.new

<span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"finding packages ... "</span>
find *.ipk | <span style="color: #ffa07a;">\</span>
        awk --traditional <span style="color: #ffa07a;">'{ printf( "echo -n .;ar -p %s control.tar.gz", $1 );</span>
<span style="color: #ffa07a;">                             printf( " | tar -xzO ./control &gt;&gt; Packages.new;" );</span>
<span style="color: #ffa07a;">                             printf( "echo Filename: %s &gt;&gt; Packages.new;", $1 );</span>
<span style="color: #ffa07a;">                             printf( "echo Size: %s &gt;&gt; Packages.new;", $1 );</span>
<span style="color: #ffa07a;">                             printf( "echo &gt;&gt; Packages.new\n" ); }'</span> &gt;&gt; ${<span style="color: #eedd82;">TFILE</span>}
<span style="color: #b0c4de;">echo</span> <span style="color: #fa8072;">`cat doit.rc | wc -l`</span> found.
/bin/sh ${<span style="color: #eedd82;">TFILE</span>}

</pre>

</li>
</ul>
<ul>
<li id="sec-5-2-6">Clean Package Dependends<br/>
<a href="./Files/do_clean.rc">do_clean.rc</a>



<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">sh</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">V0.1.0</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Used to clean up OE package dependencies.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Note, that all recursive dependencies are cleaned.</span>

<span style="color: #eedd82;">PAC</span>=${<span style="color: #eedd82;">1</span>}
<span style="color: #eedd82;">DEPLIST</span>=<span style="color: #ffa07a;">""</span>
<span style="color: #eedd82;">DEPCNT</span>=<span style="color: #ffa07a;">"0"</span>

<span style="color: #87cefa;">usage</span>()
{
        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"usage : ${0} path/to/xx.bb"</span>
        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"        cleans all xx.bb dependend packages"</span>
}

<span style="color: #87cefa;">get_args</span>()
{
        <span style="color: #00ffff;">if</span> [ <span style="color: #ffa07a;">"${PAC}"</span> == <span style="color: #ffa07a;">""</span> ]; <span style="color: #00ffff;">then</span>
                usage
                <span style="color: #00ffff;">exit</span> 1;
        <span style="color: #00ffff;">fi</span>

}

<span style="color: #87cefa;">get_deps</span>()
{
        <span style="color: #eedd82;">DEPLIST</span>=<span style="color: #fa8072;">`bbread ${PAC} | grep -E -i -e "^DEPENDS=" | sed -e 's/.*=\"//'`</span>
        <span style="color: #eedd82;">DEPLIST</span>=<span style="color: #fa8072;">`echo ${DEPLIST} | sed -e 's/\"//'`</span>
        <span style="color: #eedd82;">SELF</span>=<span style="color: #fa8072;">`echo ${PAC} | sed -e 's/\.bb$//'`</span>
        <span style="color: #eedd82;">SELF</span>=<span style="color: #fa8072;">`echo ${SELF} | sed -e 's/.*\///'`</span>
        <span style="color: #eedd82;">SELF</span>=<span style="color: #fa8072;">`echo ${SELF} | sed -e 's/_.*$//'`</span>
        <span style="color: #eedd82;">DEPLIST</span>=<span style="color: #ffa07a;">"${DEPLIST} ${SELF}"</span>
        <span style="color: #eedd82;">DEPCNT</span>=<span style="color: #fa8072;">`echo ${DEPLIST} | wc -w`</span>
        <span style="color: #b0c4de;">echo</span> found ${<span style="color: #eedd82;">DEPCNT</span>} dependend packages.
}

<span style="color: #87cefa;">askme</span>()
{
        <span style="color: #eedd82;">TMP</span>=<span style="color: #ffa07a;">""</span>
        <span style="color: #eedd82;">TR</span>=<span style="color: #ffa07a;">"1"</span>

        <span style="color: #00ffff;">for</span> r<span style="color: #00ffff;"> in</span> ${<span style="color: #eedd82;">DEPLIST</span>}; <span style="color: #00ffff;">do</span>
                <span style="color: #00ffff;">if</span> [ <span style="color: #ffa07a;">"${TR}"</span> != <span style="color: #ffa07a;">""</span> ]; <span style="color: #00ffff;">then</span>
                        <span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Clean '${r}' Yes/(N)o/Rest ? : "</span>
                        <span style="color: #b0c4de;">read</span> aa
                <span style="color: #00ffff;">fi</span>
                <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"${aa}"</span><span style="color: #00ffff;"> in</span>
                        Y )
                        <span style="color: #eedd82;">TMP</span>=<span style="color: #ffa07a;">"${TMP} ${r}"</span>
                        ;;
                        R )
                        <span style="color: #eedd82;">TR</span>=<span style="color: #ffa07a;">""</span>
                        <span style="color: #eedd82;">TMP</span>=<span style="color: #ffa07a;">"${TMP} ${r}"</span>
                        ;;
                <span style="color: #00ffff;">esac</span>
        <span style="color: #00ffff;">done</span>

        <span style="color: #eedd82;">DEPLIST</span>=${<span style="color: #eedd82;">TMP</span>}
        <span style="color: #eedd82;">DEPCNT</span>=<span style="color: #fa8072;">`echo ${DEPLIST} | wc -w`</span>
}

<span style="color: #87cefa;">grepit</span>()
{
        <span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Enter a : pattern to grep  "</span>
        <span style="color: #b0c4de;">read</span> REGI

        <span style="color: #eedd82;">TMP</span>=<span style="color: #ffa07a;">""</span>
        <span style="color: #00ffff;">for</span> r<span style="color: #00ffff;"> in</span> ${<span style="color: #eedd82;">DEPLIST</span>}; <span style="color: #00ffff;">do</span>
                <span style="color: #eedd82;">s</span>=<span style="color: #fa8072;">`echo ${r} | grep -v ${REGI}`</span>
                <span style="color: #eedd82;">TMP</span>=<span style="color: #ffa07a;">"${TMP} ${s}"</span>
        <span style="color: #00ffff;">done</span>

        <span style="color: #eedd82;">DEPLIST</span>=${<span style="color: #eedd82;">TMP</span>}
        <span style="color: #eedd82;">DEPCNT</span>=<span style="color: #fa8072;">`echo ${DEPLIST} | wc -w`</span>
}

<span style="color: #87cefa;">ask_user</span>()
{
        <span style="color: #00ffff;">if</span> [ <span style="color: #ffa07a;">"${DEPCNT}"</span> == <span style="color: #ffa07a;">"0"</span> ]; <span style="color: #00ffff;">then</span>
                <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Nothing to clean ;-)"</span>
                <span style="color: #00ffff;">exit</span> 0
        <span style="color: #00ffff;">fi</span>

        <span style="color: #b0c4de;">echo</span> Really clean the following packages ?
        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"======================================================="</span>
        <span style="color: #b0c4de;">echo</span> ${<span style="color: #eedd82;">DEPLIST</span>}
        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"======================================================="</span>
        <span style="color: #b0c4de;">echo</span> -n <span style="color: #ffa07a;">"Yes/(N)o/Askme/Grep : "</span>
        <span style="color: #b0c4de;">read</span> aa

        <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"${aa}"</span><span style="color: #00ffff;"> in</span>
                Y )
                        ;;
                G )
                        grepit
                        ask_user
                        ;;
                A )
                        askme
                        ask_user
                        ;;
                * )
                        <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"aborted :-("</span>
                        <span style="color: #00ffff;">exit</span> 1
                        ;;
        <span style="color: #00ffff;">esac</span>
}

<span style="color: #87cefa;">doit</span>()
{
        <span style="color: #b0c4de;">echo</span>
        <span style="color: #b0c4de;">echo</span> -n cleaning, please wait 
        bitbake -c clean ${<span style="color: #eedd82;">DEPLIST</span>}
}

get_args
get_deps
ask_user
doit


</pre>


<ul>
<li>use
</li>
</ul>




<pre class="src src-sh">$ do_clean.rc ../openembedded/packages/meta/opie-image.bb
</pre>


</li>
</ul>
<ul>
<li id="sec-5-2-7">Customize to you needs<br/>
<ul>
<li id="sec-5-2-7-1">Adding another package repository<br/>
The new BBFILES line(s) are e.g.



<pre class="src src-sh">BBFILES := <span style="color: #ffa07a;">"${HOME}/dev/oe/org.openembedded.dev/packages/*/*.bb"</span>
<span style="color: #eedd82;">BBFILES</span> += <span style="color: #ffa07a;">"${HOME}/myoe/packages/*/*.bb"</span>
</pre>

</li>
</ul>
<ul>
<li id="sec-5-2-7-2">Adding a new machine<br/>
</li>
</ul>
<ul>
<li id="sec-5-2-7-3">Adding a new distro<br/>
</li>
</ul>
<ul>
<li id="sec-5-2-7-4">Adding a new bootstrap-image<br/>
</li>
</ul>
<ul>
<li id="sec-5-2-7-5">Build the above mentioned bootstrap-image<br/>
</li>
</ul>
<ul>
<li id="sec-5-2-7-6">Example : Adding a new package (from existing sources)<br/>
<p class="info">Info: Preparing the Makefile </p>
This subsection describes the changes I had to do on the Makefile and the way to create and provide an appropriate patch.

<p class="verse">
Unpack the sources tgz or the cvs dir into your patch dir and create a copy of the resulting dir named xxx<sub>orig</sub>.<br/>
Edit the non <sub>orig's</sub> Makefile.<br/>
Remove (or comment) the CC entry to force CROSS usage<br/>
Remove (or comment) the CFLAGS entry to force bitbake CFLAGS usage.<br/>
Note, that this may be wrong, when non standard entries need to be provided. Change the CFLAGS to e.g. CYFLAGS entry in the complete Makefile in this case.<br/>
Added $(DESTDIR) to the PRFIX variable to cause make to install binaries to the ${D} dir instead to /<br/>
Potentially you do not want to install something like includ or man pages.<br/>
remove that targets from Makefile then.<br/>
Create a patch calling diff -Naur xxx xxx<sub>orig</sub> &gt; xxx<sub>make</sub>.patch where xxx is your packages dir name.<br/>
Copy that patch to myoe/packages/schedutils/schedutils dir (matching the SRC<sub>URI's</sub> patch entry described above ).<br/>
</p>


<p>
Done that changes, you have the chance to build your new package.
</p>
</li>
</ul>
</li>
</ul>
<ul>
<li id="sec-5-2-8">FAQ<br/>
<ul>
<li id="sec-5-2-8-1">During build process, a package complains not to find shared libs for installation<br/>
This occured e.g. with the readline package for opie image. I did not
find out, why this happens. The possible solution (at least it works
on my system) is a manual (non bitbake) <code>make clean;./configure</code> and
afterwards a <code>bitbake -b ../.../readline_x.y.bb -c build</code>. It seems to
have something to do with the configuration phase of bitbake for this
package.

</li>
</ul>
<ul>
<li id="sec-5-2-8-2">How can I add a customized /etc/fstab ?<br/>
<code>/oe/sources/openembedded/recipes/base-files/base-files/fstab</code>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-11-29T00:47+0800</p>
<p class="author">Author: Shi Shougang</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.2+ with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
